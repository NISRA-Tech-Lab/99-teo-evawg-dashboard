---
title: "recorded-crime-1"
---



```{r}
#| include: FALSE

library(here)
source(paste0(here(), "/data_prep/recordedcrime_data_prep.R"))
```

## Row

### Column {width=50%}

```{r}
# Ensure Year is an ordered factor
police_rec_crime_98_24$Year <- factor(police_rec_crime_98_24$Year, levels = unique(police_rec_crime_98_24$Year), ordered = TRUE)

# Create numeric version of Year for regression
police_rec_crime_98_24$Year_num <- as.numeric(police_rec_crime_98_24$Year)

# Get unique years and select alternate ones
years <- unique(police_rec_crime_98_24$Year)
alternate_years <- years[seq(1, length(years), by = 2)]

# Create SharedData object for Crosstalk
shared_crime <- SharedData$new(police_rec_crime_98_24, group = "crime_group")

# Compute trend lines
trend_lines <- police_rec_crime_98_24 %>%
  group_by(Offence) %>%
  do({
    model <- lm(Value ~ Year_num, data = .)
    data.frame(
      Year = .$Year,
      Fitted = predict(model),
      Offence = .$Offence
    )
  })

# Wrap trend lines in SharedData
shared_trend <- SharedData$new(trend_lines, group = "crime_group")

# Create line chart and add trend lines
line_chart <- plot_ly(shared_crime,
                      x = ~Year,
                      y = ~Value,
                      type = 'scatter',
                      mode = 'lines+markers',
                      color = ~Offence,
                      text = ~paste("Year:", Year, "<br>Value:", Value),
                      hoverinfo = 'text') %>%
  layout(
    title = "Crime Trends by Category (Line Chart)",
    xaxis = list(
      title = "Year",
      tickangle = 0,
      tickvals = alternate_years,
      ticktext = alternate_years,
      showgrid = FALSE,
      zeroline = FALSE,
      showline = TRUE
    ),
    yaxis = list(
      title = "",
      showgrid = FALSE,
      showline = TRUE,
      zeroline = FALSE
    ),
    margin = list(l = 80, r = 40, b = 80, t = 100),
    annotations = list(
      list(
        text = "Number of Incidents",
        xref = "paper",
        yref = "paper",
        x = -0.08,  # adjust left/right
        y = 1.08,   # adjust vertical position
        showarrow = FALSE,
        textangle = 0,
        font = list(size = 14)
      )
    )
  )

# Display with Crosstalk filter
bscols(
  widths = c(3, 9),
  filter_select("category_filter", "Select Crime Category", shared_crime, ~Offence),
  line_chart
)
```


### Column {width=50%}

```{r}

```

