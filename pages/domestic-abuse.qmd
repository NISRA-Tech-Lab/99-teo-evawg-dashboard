---
title: "domestic-abuse-1"

---



```{r}
#| include: FALSE

library(here)
source(paste0(here(), "/data_prep/domabuse_data_prep.R"))
```

## Row

### Column {width=50%}


```{r}
#| title: Number of Domestic Abuse Crimes & Incidents 2004-2025
#| fig-height: 10

DA_chart1 <- plot_ly(
  DA_chart1_data,
  x = ~yaxis_year,
  y = ~Incidents,
  type = 'scatter',
  mode = 'lines+markers',
  name = "Incidents",
  line = list(color = nisra_colours[[3]]),
  marker = list(color = nisra_colours[[3]]),
  hoverinfo = 'text',
  text = ~paste0(Year, "<br>Incidents: ", format(Incidents, big.mark = ","))
) %>%
  add_trace(
    y = ~Crimes,
    mode = 'lines+markers',
    name = "Crimes",
    line = list(color = nisra_colours[[2]]),
    marker = list(color = nisra_colours[[2]]),
    text = ~paste0(Year, "<br>Crimes: ", format(Crimes, big.mark = ",")),
    hoverinfo = 'text'
  ) %>%
  layout(
    showlegend = TRUE,
    font = list(family = "Arial", size = 14),
    margin = list(t = 50),
    xaxis = list(
      title = list(text = "Year", standoff = 10),
      type = "category",  # <-- Treat x-axis as categorical
      categoryorder = "array",
      categoryarray = DA_chart1_data$yaxis_year,  # <-- Ensure ordering matches data
      tickmode = "array",
      tickvals = DA_chart1_data$yaxis_year,
      ticktext = DA_chart1_data$yaxis_year,
      showline = TRUE,
      linecolor = "#000000",
      showgrid = FALSE,
      ticks = "outside",
      tickwidth = 2,
      tickangle = 0,
      automargin = TRUE
    ),
    yaxis = list(
      title = "",
      showline = TRUE,
      linecolor = "#000000",
      showgrid = FALSE,
      rangemode = "tozero",
      tickformat = ",.0f"
    ),
    annotations = list(
      list(
        x = 0.01, y = 1.03,
        text = "Incidents and Crimes",
        showarrow = FALSE,
        xref = "paper", yref = "paper",
        xanchor = "center", yanchor = "middle",
        font = list(size = 14, color = "black")
      )
    )
  ) %>%
  config(displayModeBar = FALSE)

DA_chart1


```


### Column {width=50%}

```{r}
#| title: Types of Domestic Abuse Crimes 2024/25
#| fig-height: 10

DA_chart2 <- plot_ly(
  data = DA_chart2_data,
  labels = ~`Crime Type`,
  values = ~Percentage,
  type = 'pie',
  text = ~paste0(Percentage, "%"),  
  textinfo = "text",                
  sort = FALSE,
  direction = "clockwise",
  marker = list(colors = nisra_colours[1:5]),
  hoverinfo = 'text',
  hovertext = ~paste0(
    da_currentyear, "<br>",
    `Crime Type`, ": ", format(Count, big.mark = ","), "<br>",
    "Share: ", Percentage, "%"
  )
) %>%
  layout(
    title = " ",
    font = list(family = "Arial", size = 14),
    showlegend = TRUE,
    legend = list(x = 1, y = 0.5),
    pie = list(
      direction = "clockwise",   
      rotation = 0               
    )
  ) %>%
  config(displayModeBar = FALSE)

DA_chart2

```
Note 1: Including homicide and death or serious injury-unlawful driving.
```{r}
#| title: Percentage of Domestic Abuse Experience by Gender 2018/19
#| fig-height: 10

DA_chart3 <- plot_ly(
  data = DA_chart3_data,
  x = ~Group,
  y = ~Percentage,
  color = ~category,
  colors = nisra_colours[2:3],
  type = "bar",
  barmode = "group",
  text = ~paste0(category, "<br>", Group, ": ", Percentage, "%"),
  hoverinfo = "text"   
) %>%
  layout(
    title = "",
    margin = list(t = 50),
    xaxis = list(title = "Group"),
    yaxis = list(
      title = "",        
      showline = TRUE,   
      zeroline = TRUE,   
      showticklabels = TRUE  
    ),
    legend = list(title = list(text = "Category")),
    annotations = list(
      list(
        x = -0.008,
        xref = "paper",
        xanchor = "center",
        y = 1.025,
        yref = "paper",
        yanchor = "bottom",
        text = "Percentage %",
        showarrow = FALSE,
        font = list(size = 14)
      )
    )
  ) %>%
  config(displayModeBar = FALSE)

DA_chart3

```


