---
title: "YLT"
---


```{r}
#| include: FALSE

library(here)
source(paste0(here(), "/data_prep/main_data_prep.R"))
```

## Row

### Column {width=50%}

```{r}
plot_ly() %>%
  add_trace(data = ylt_historical_chart1, x = ~year, y = ~GVTYPV1, type = 'scatter',
            mode = 'lines+markers', name = 'Physical violence',
            line = list(color = nisra_colours[2]),
            marker = list(color = nisra_colours[2]),
            hovertemplate = "Year: %{x}<br>Value: %{y:.2f}%<extra></extra>") %>%
  add_trace(data = ylt_historical_chart1, x = ~year, y = ~GVTYPV2, type = 'scatter',
            mode = 'lines+markers', name = 'Sexual violence',
            line = list(color = nisra_colours[3]),
            marker = list(color = nisra_colours[3]),
            hovertemplate = "Year: %{x}<br>Value: %{y:.2f}%<extra></extra>") %>%
  add_trace(data = ylt_historical_chart1, x = ~year, y = ~GVTYPV3, type = 'scatter',
            mode = 'lines+markers', name = 'Psychological violence',
            line = list(color = nisra_colours[4]),
            marker = list(color = nisra_colours[4]),
            hovertemplate = "Year: %{x}<br>Value: %{y:.2f}%<extra></extra>") %>%
  add_trace(data = ylt_historical_chart1, x = ~year, y = ~GVTYPV4, type = 'scatter',
            mode = 'lines+markers', name = 'Online violence',
            line = list(color = nisra_colours[5]),
            marker = list(color = nisra_colours[5]),
            hovertemplate = "Year: %{x}<br>Value: %{y:.2f}%<extra></extra>") %>%
  layout(
    title = list(
      text = "Experienced Violence Over Time",
      y = 0.98,
      x = 0.5,
      xanchor = "center"
    ),
    margin = list(t = 100),
    xaxis = list(
      title = list(
        text = "Year",
        font = list(size = 14)
      ),
      tickmode = "array",
      tickvals = ylt_historical_chart1$year,
      showgrid = FALSE,
      showline = TRUE,  
      linecolor = "black", 
      linewidth = 1 
    ),
    yaxis = list(
      title = "",  
      automargin = TRUE,
      titlefont = list(size = 0),
      standoff = 0,
      showgrid = FALSE,
      showline = TRUE, 
      linecolor = "black",
      linewidth = 1
    ),
    legend = list(title = list(text = "")),
    annotations = list(
      list(
        x = -0.008,
        xref = "paper",
        xanchor = "center",
        y = 1.1,
        yref = "paper",
        yanchor = "bottom",
        text = "Percentage %",
        showarrow = FALSE,
        font = list(size = 14)
        )
      ),
    hoverlabel = list(
      font = list(color = "white")  # <-- Sets hover text to white
    )
  ) %>%
  config(displayModeBar = FALSE)

```


### Column {width=50%}

```{r}
# Ensure the year column is treated as a categorical variable
ylt_historical_chart2$year <- as.character(ylt_historical_chart2$year)

# Wrap the data in SharedData for Crosstalk interactivity
shared_ylt <- SharedData$new(ylt_historical_chart2, key = ~variable, group = "vars")

# Get the unique years for setting tick values
unique_years <- sort(unique(ylt_historical_chart2$year))

# Single-selection dropdown for 'variable'
filter_select(
  id = "var_filter",
  selected = "GVTYPV2",
  label = "Select Variable",
  sharedData = shared_ylt,
  group = ~variable,
  multiple = FALSE   # Only allow one variable selection at a time
)

# Plotly interactive line chart
plot_ly(shared_ylt, 
        x = ~year, 
        y = ~percentage_yes, 
        color = ~gender, 
        type = 'scatter', 
        mode = 'lines+markers',
        hoverinfo = "text",
        text = ~paste("Year:", year,
                      "<br>Variable:", variable,
                      "<br>Gender:", gender,
                      "<br>Percentage Yes:", percentage_yes)) %>%
  layout(
    title = "Percentage Saying Yes Over Time",
    xaxis = list(
      title = "Year",
      showgrid = FALSE,
      showline = TRUE,         
      linecolor = "black",     
      linewidth = 1,
      tickvals = unique_years,     
      ticktext = unique_years      
    ),
    yaxis = list(
      title = "Percentage Saying Yes",
      showgrid = FALSE,
      showline = TRUE,         
      linecolor = "black",    
      linewidth = 1  
    ),
    legend = list(title = list(text = "Gender")),
    
    # Set hover text color to white
    hoverlabel = list(
      font = list(color = "white")
    )
  ) %>%
  config(displayModeBar = FALSE)

```

