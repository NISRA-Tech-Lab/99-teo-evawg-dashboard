---
title: "YLT"
---


```{r}
#| include: FALSE

library(here)
source(here("data_prep/main_data_prep.R"))
```

## Row

### Column {width=50%}

```{r}
#| title: Experience of gender-based violence in the last year
#| fig-height: 10

plot_ly() %>%
  add_trace(data = ylt_historical_chart1, x = ~year, y = ~GVTYPV1, type = 'scatter',
            mode = 'lines+markers', name = 'Physical violence',
            line = list(color = nisra_colours[2]),
            marker = list(color = nisra_colours[2]),
            hovertemplate = "%{x}<br>%{fullData.name}: %{y:.0f}%<extra></extra>") %>%
  add_trace(data = ylt_historical_chart1, x = ~year, y = ~GVTYPV2, type = 'scatter',
            mode = 'lines+markers', name = 'Sexual violence',
            line = list(color = nisra_colours[3]),
            marker = list(color = nisra_colours[3]),
            hovertemplate = "%{x}<br>%{fullData.name}: %{y:.0f}%<extra></extra>") %>%
  add_trace(data = ylt_historical_chart1, x = ~year, y = ~GVTYPV3, type = 'scatter',
            mode = 'lines+markers', name = 'Psychological violence',
            line = list(color = nisra_colours[4]),
            marker = list(color = nisra_colours[4]),
            hovertemplate = "%{x}<br>%{fullData.name}: %{y:.0f}%<extra></extra>") %>%
  add_trace(data = ylt_historical_chart1, x = ~year, y = ~GVTYPV4, type = 'scatter',
            mode = 'lines+markers', name = 'Online violence',
            line = list(color = nisra_colours[5]),
            marker = list(color = nisra_colours[5]),
            hovertemplate = "%{x}<br>%{fullData.name}: %{y:.0f}%<extra></extra>") %>%
  layout(
    margin = list(t = 40),
    xaxis = list(
      title = list(
        text = "Year",
        font = list(size = 14)
      ),
      tickmode = "array",
      tickvals = ylt_historical_chart1$year,
      showgrid = FALSE,
      showline = TRUE,  
      linecolor = "black", 
      linewidth = 1 
    ),
    yaxis = list(
      title = "",  
      automargin = TRUE,
      titlefont = list(size = 0),
      standoff = 0,
      showgrid = FALSE,
      showline = TRUE, 
      linecolor = "black",
      linewidth = 1,
      rangemode = "tozero"
    ),
    legend = list(title = list(text = ""),
                  x = 1, xref = "paper", xanchor = "right"),
    annotations = list(
      list(
        x = -0.008,
        xref = "paper",
        xanchor = "center",
        y = 1.025,
        yref = "paper",
        yanchor = "bottom",
        text = "Percentage %",
        showarrow = FALSE,
        font = list(size = 14)
        )
      ),
    hoverlabel = list(
      font = list(color = "white")  
    )
  ) %>%
  config(displayModeBar = FALSE)

```


### Column {width=50%}

```{r}
#| title: Experience of gender-based violence in the last year, by gender
#| fig-height: 10

# 1. Map codes → readable violence-type names
violence_labels <- c(
  GVTYPV1 = "Physical violence",
  GVTYPV2 = "Sexual violence",
  GVTYPV3 = "Psychological violence",
  GVTYPV4 = "Online violence"
)

# 2. Prepare data (recode + drop rows with unknown codes)
ylt_historical_chart2 <- ylt_historical_chart2 %>%
  mutate(
    year           = as.character(year),
    variable_label = recode(variable, !!!violence_labels)
  ) %>%
  filter(!is.na(variable_label))

# 3. Crosstalk wrapper 
shared_ylt <- SharedData$new(
  ylt_historical_chart2,
  key   = ~variable,
  group = "violence_type"
)

# 4. Year tick values
unique_years <- sort(unique(ylt_historical_chart2$year))

# 5. Dropdown (single-select, no “(All)” CSS workaround optional) ─
filter_select(
  id         = "var_filter",
  label      = "Select Violence Type",
  sharedData = shared_ylt,
  group      = ~variable_label,
  selected   = "Sexual violence",
  multiple   = FALSE      
)

# 6. Plotly line chart with y-axis annotation and extra top margin ─
plot_ly(shared_ylt,
        x     = ~year,
        y     = ~percentage_yes,
        color = ~gender,
        colors = c(nisra_colours[1], nisra_colours[2]),
        type  = "scatter",
        mode  = "lines+markers",
        hoverinfo = "text",
        text  = ~paste0(
                year,
                "<br>", gender,
                "<br>", variable_label, ": ", sprintf("%.0f%%", percentage_yes))) %>%
  layout(
      xaxis = list(
      title     = "Year",
      showgrid  = FALSE,
      showline  = TRUE,
      linecolor = "black",
      linewidth = 1,
      tickvals  = unique_years,
      ticktext  = unique_years
    ),
    yaxis = list(
      title     = "",          
      showgrid  = FALSE,
      showline  = TRUE,
      linecolor = "black",
      linewidth = 1,
      rangemode = "tozero"
    ),
    legend = list(title = list(text = ""),
                  x = 1, xref = "paper", xanchor = "right"),   
    margin = list(t = 40),                   
    annotations = list(
      list(
        x          = -0.008,
        xref       = "paper",
        xanchor    = "center",
        y          = 1.025,
        yref       = "paper",
        yanchor    = "bottom",
        text       = "Percentage %",
        showarrow  = FALSE,
        font       = list(size = 14)
      )
    ),
    hoverlabel = list(font = list(color = "white"))
  ) %>%
  config(displayModeBar = FALSE)

```

## Row
Source: <a href="https://view.officeapps.live.com/op/view.aspx?src=https%3A%2F%2Fwww.executiveoffice-ni.gov.uk%2Fsites%2Fdefault%2Ffiles%2F2025-05%2Fdata-tables%2520%25281%2529.xlsx&wdOrigin=BROWSELINK" target="_blank">
Ending Violence Against Women and Girls: Experiences and Attitudes of 16 year olds in Northern Ireland (XLSX 1.02MB)
</a>
